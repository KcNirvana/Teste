{"time":"0017","tplId":"QUICKPAY@open-account-auth-flex","publishVersion":"150924","tag":"QUICKPAY","name":"open-account-auth-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","children":[{"text":"// 别名\n    var create = amc.fn.create;\n    var getTag = amc.fn.getById;\n    var hide = amc.fn.hide;\n    var show = amc.fn.show;\n\n    var rpc = amc.rpcData;\n    var params = rpc.params || {};\n\n    var checkedPng = amc.path + 'alipay_msp_checked';\n    var logoPng = params.logo_url || '';\n    var partnerName = params.auth_title || '';\n    var optionTitle = params.auth_option_title || '';\n\n    var account = rpc.hidden_logon_id || '';\n    var accountInfoTitle = '支付宝账号：' + account;\n\n    var authInfoTitle = params.authInfoTitle;\n    // 如果服务端没有下发则在模板进行拼接\n    if (!authInfoTitle) {\n        authInfoTitle = '您同意将以下信息授权给 ' + partnerName;\n    }\n\n    var authOptionList = params.auth_option_list || '';\n\n    // 是否是三星授权@连挚\n    var isSamsungAuth = (params.service === 'com.alipay.vendorpay.validate');\n    // 服务端: @乐进， 模板: @醉杭\n    var isInsideAuth = (params.auth_scene === 'inside');\n\n    // 是否显示切换账户 @松然\n    // 备注: 三星授权不显示切换账户\n    var isShowChangeAcc = params.show_change_acc && !isSamsungAuth;\n\n    var checkboxs = [];\n    var protocols = [];\n    var authTypeText = (params.auth_type === 'LOGIN') ? '{{login}}' : '{{auth}}';\n    var canAuth = true;\n\n    // 初始化\n    function init() {\n        try {\n            initUI();\n\n            if (amc.fn.logPageInit) {\n                amc.fn.logPageInit(true);\n            }\n        } catch (e) {\n            if (amc.fn.logPageInit) {\n                amc.fn.logPageInit();\n            }\n        }\n    }\n\n    function initUI() {\n\n        var nav = amc.fn.navBack(false, amc.fn.i18nPlaceholderReplace('{{alipay_with_sth}}', authTypeText), null, null, onBack, null);\n        getTag('body').insertBefore(nav, getTag('mainBody'));\n\n        getTag('logo').src = logoPng;\n\n        getTag('btnText').innerText = amc.fn.i18nPlaceholderReplace('{{confirm_sth}}', authTypeText);\n        getTag('btnText').style.maxWidth = window.innerWidth - 70;\n\n        getTag('banner').className = amc.isIOS ? 'top-bg amc-v-box banner-bg-ios' : 'top-bg amc-v-box banner-bg-android';\n        getTag('authInfoTitle').innerText = authInfoTitle;\n\n        var accountInfo = getTag('accountInfo');\n        accountInfo.innerText = accountInfoTitle;\n        accountInfo.style.maxWidth = window.innerWidth - 30 - (isShowChangeAcc ? 60 : 0);\n\n        if (isShowChangeAcc) {\n            show('changeBtn');\n        }\n\n        // 创建授权列表\n        if (params.auth_text_list) {\n            show('authItemsBox');\n            var tmpList = params.auth_text_list || [];\n\n            // @连挚 厂商支付授权\n            // 三星需要增加二维码授权项\n            if (isSamsungAuth) {\n                tmpList.push('{{auth_qrcode_info}}');\n            }\n\n            var authItems = getTag('authItems');\n            for (var i = 0; i < tmpList.length; i++) {\n                var itemBox = create('div', 'auth-item', authItems);\n                var dot = create('div', 'auth-dot', itemBox);\n                var label = create('label', 'auth-item-text amc-ellipsis', itemBox);\n                label.innerText = tmpList[i];\n            }\n        }\n\n        // 创建checkbox列表\n        checkboxs = getOptionList(authOptionList, 'TEXT');\n        if (checkboxs && checkboxs.length > 0) {\n            for (var idx in checkboxs) {\n                initCheckbox(checkboxs[idx]);\n            }\n        }\n\n        // 显示协议\n        protocols = getOptionList(authOptionList, 'URL');\n        if (protocols.length === 0) {\n            hide('protocolArea');\n        }\n\n        // 显示底部提示文案\n        if (isInsideAuth && params.insideTip) {\n            show('insideTipBox');\n            getTag('insideTip').innerText = params.insideTip;\n        }\n\n        getTag('mainBody').style.height = amc.specs.bodyHeight;\n    }\n\n    // 获取选项列表\n    function getOptionList(optionList, key) {\n        var list = [];\n        for (var idx in optionList) {\n            if (optionList[idx].type === key) {\n                list.push(optionList[idx]);\n            }\n        }\n        return list;\n    }\n\n    // 初始化checkbox\n    function initCheckbox(checkitem) {\n        var checkArea = getTag('checkArea');\n        var checkCell = create('div');\n        checkCell.className = 'amc-align-center check-item';\n\n        var checkbox;\n        // 强制选中状态用图片作为checkbox,因为鸟巢暂时不支持disable状态\n        if (checkitem.forced) {\n            checkbox = create('img');\n            checkbox.className = 'check-img';\n            checkbox.src = checkedPng;\n            checkCell.appendChild(checkbox);\n        } else {\n            checkbox = create('input');\n            checkCell.appendChild(checkbox);\n            checkbox.type = 'checkbox';\n            checkbox.className = amc.isIOS ? 'checkbox-ios' : 'checkbox-android';\n            checkbox.checked = checkitem.checked;\n        }\n\n        checkbox.className = checkbox.className + ' margin-r-xs';\n\n        checklabel = create('label');\n        checklabel.innerText = checkitem.optionText;\n        checklabel.className = 'check-text amc-flex-1 amc-ellipsis';\n        checkCell.appendChild(checklabel);\n\n        checkCell.onclick = function() {\n            checkbox.checked = !checkbox.checked;\n        }\n\n        checkArea.appendChild(checkCell);\n        checkitem['_checkbox'] = checkbox;\n    }\n\n    // 打开协议\n    function showProtocol() {\n        for (var i = 0; i < protocols.length; i++) {\n            protocols[i]['text'] = '{{serve_protocol}}';\n            protocols[i]['url'] = protocols[i]['optionText'];\n        }\n        amc.fn.showProtocolList(protocols);\n    }\n\n    // 验密请求\n    function onSubmit() {\n        if (!canAuth) {\n            return;\n        }\n\n        var agrees = [];\n        for (var i = 0; i < checkboxs.length; i++) {\n            if (checkboxs[i].forced) {\n                agrees.push(checkboxs[i].optionKey);\n            } else if (checkboxs[i]['_checkbox'].checked === true || checkboxs[i]['_checkbox'].checked === '1') {\n                agrees.push(checkboxs[i].optionKey);\n            }\n        }\n\n        agrees.push('PROTOCOL');\n        var obj;\n\n        if (isSamsungAuth) {\n            obj = {\n                'param': { 'agree': agrees, 'service': 'com.alipay.vendorpay.validate' },\n                'action': { 'name': '/open/service', 'loadtxt': '' }\n            };\n        } else if (isInsideAuth) {\n            obj = {\n                'param': { 'agree': agrees, 'service': 'com.alipay.account.auth' },\n                'action': { 'name': '/open/service', 'loadtxt': '' }\n            };\n        } else {\n            obj = {\n                'param': { 'agree': agrees },\n                'action': { 'name': '/account/auth', 'loadtxt': '' }\n            };\n        }\n\n        amc.fn.playGif(getTag('gifImg'), amc.res.loading);\n        getTag('btnText').innerText = '{{confirming_upgrade}}';\n\n        document.submit(obj);\n        setTimeout(resetBtn, 3000);\n        canAuth = false;\n    }\n\n    // 更换账户\n    function onSwitchAccount() {\n        var obj = { 'action': { 'name': '/cashier/switchAccount' } };\n        document.submit(obj);\n    }\n\n    // 重置按钮\n    function resetBtn() {\n        amc.fn.playGif(getTag('gifImg'), '');\n        getTag('btnText').innerText = amc.fn.i18nPlaceholderReplace('{{confirm_sth}}', authTypeText);\n        canAuth = true;\n    }\n\n    // Android硬返回\n    function onKeyDown() {\n        if (event.which == 4) {\n            onBack();\n        }\n    }\n\n    // 退出\n    function onBack() {\n        amc.fn.exitConfirm();\n    }","tag":"text"}]},{"tag":"style","children":[{"text":".bold-text {\n        font-weight: bold\n    }\n\n    .amc-nav-r-box {}\n\n    .amc-nav-l-text {\n        color: #108ee9;\n        font-size: 14px;\n        text-align: left;\n    }\n\n    .agree-label {\n        max-width: 100px;\n    }\n\n    .stretch-self {\n        align-self: stretch;\n    }\n\n    .inside-tip-box {\n        min-height: 63px;\n        padding: 5px 15px 24px 15px;\n        justify-content: flex-end;\n    }\n\n    .inside-tip {\n        font-size: 13px;\n        color: #888;\n    }\n\n    .top-bg {\n        min-height: 140px;\n        max-height: 140px;\n        height: 140px;\n        padding: 20px 15px 15px 15px;\n    }\n\n    .logo-area {\n        margin-top: -105px;\n        padding: 10px;\n    }\n\n    .logo-pd-box {\n        -moz-box-shadow: 0 14px 10px -12px rgba(0, 0, 0, 0.7);\n        -webkit-box-shadow: 0 14px 10px -12px rgba(0, 0, 0, 0.7);\n        box-shadow: 0 14px 10px -12px rgba(0, 0, 0, 0.7);\n        padding: 2.5px;\n        border-radius: 5px;\n    }\n\n    .logo {\n        height: 70px;\n        width: 70px;\n    }\n\n    .logo-box {\n        border-radius: 5px;\n    }\n\n    .white-pd {\n        height: 57.5px;\n    }\n\n    .change-btn {\n        max-width: 100px;\n        margin-left: 6px;\n        font-size: 15px;\n        color: #fff;\n    }\n\n    .account-info {\n        font-size: 15px;\n        color: #fff;\n        opacity: 0.8;\n    }\n\n    .auth-info-title {\n        font-size: 15px;\n        color: #000;\n    }\n\n    .pd-b {\n        padding-bottom: 15px;\n    }\n\n    .pd-lr {\n        padding-left: 15px;\n        padding-right: 15px;\n    }\n\n    .auth-items-box {\n        padding: 0 15px 15px 15px;\n    }\n\n    .auth-items {\n        padding-top: 6px;\n    }\n\n    .auth-dot {\n        height: 4px;\n        width: 4px;\n        border-radius: 2px;\n        background-color: #888;\n        margin-right: 6px;\n    }\n\n    .auth-item {\n        margin-top: 9px;\n        align-items: center;\n    }\n\n    .auth-item-text {\n        font-size: 15px;\n        color: #888;\n    }\n\n    .check-text {\n        font-size: 15px;\n        color: #000;\n    }\n\n    .check-item {\n        padding-top: 18px;\n    }\n\n    .margin-t {\n        margin-top: 15px;\n    }\n\n    .btn-box {\n        padding-top: 30px;\n        padding-bottom: 15px;\n    }\n\n    .auth-info-title-box {\n        padding: 10px 15px 15px 15px;\n    }\n\n    .font-m {\n        font-size: 15px;\n    }\n\n    .font-l {\n        font-size: 18px;\n    }\n\n    .margin-r-xs {\n        margin-right: 6px;\n    }\n\n    .btn-primary {\n        background-color: #108ee9;\n        border: 0;\n        border-radius: 4px;\n        color: #fff;\n        font-size: 18px;\n        height: 43px;\n        max-height: 43px;\n        min-height: 43px;\n        flex: 1.0;\n    }\n\n    .btn-primary:active {\n        background-color: #1284D6;\n        color: #fff;\n    }\n\n    .btn-primary:disabled {\n        background-color: #ebebf0;\n        color: #d2d2d2;\n    }\n\n    .btn-img {\n        width: 24px;\n        height: 24px;\n        margin-right: 8px;\n    }\n\n    .check-img {\n        height: 15px;\n        width: 15px;\n    }\n\n    .checkbox-ios {\n        width: 15px;\n        height: 15px;\n        background-image: url(AlipaySDK.bundle/alipay_msp_check);\n        background-size: 15px 15px;\n    }\n\n    .checkbox-ios:checked {\n        background-image: url(AlipaySDK.bundle/alipay_msp_checked);\n    }\n\n    .checkbox-ios:disabled {\n        background-image: url(AlipaySDK.bundle/alipay_msp_check_disable);\n    }\n\n    .checkbox-android {\n        width: 15px;\n        height: 15px;\n        background-image: url(com.alipay.android.app/alipay_msp_check);\n        background-size: 15px 15px;\n    }\n\n    .checkbox-android:checked {\n        background-image: url(com.alipay.android.app/alipay_msp_checked);\n    }\n\n    .checkbox-android:disabled {\n        background-image: url(com.alipay.android.app/alipay_msp_check_disable);\n    }\n\n    .banner-bg-ios {\n        background-image: url(AlipaySDK.bundle/alipay_msp_auth_bg);\n    }\n\n    .banner-bg-android {\n        background-image: url(com.alipay.android.app/alipay_msp_auth_bg);\n    }\n\n    .pd-s {\n        padding: 7px;\n    }\n\n    .protocol-area {\n        padding-top: 18px;\n    }","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"mainBody","tag":"div","children":[{},{"id":"banner","tag":"div","children":[{"tag":"div","children":[{"id":"accountInfo","tag":"label","css":"account-info amc-ellipsis"},{"tag":"div","children":[{"id":"changeBtn","tag":"label","children":[{"text":"{{sel}}","tag":"text"}],"onclick":"onSwitchAccount()","css":"change-btn amc-hidden"}],"css":"pd-s amc-align-center"}],"css":"amc-justify-center"}],"css":"top-bg amc-v-box"},{"tag":"div","css":"white-pd amc-bg-white"},{"tag":"div","children":[{},{"tag":"div","children":[{},{"tag":"div","children":[{"id":"logo","tag":"img","css":"logo"}],"css":"logo-box"}],"css":"logo-pd-box amc-flex-center amc-bg-white"}],"css":"logo-area amc-v-box amc-align-center"},{},{"tag":"div","children":[{"tag":"div","children":[{"id":"authInfoTitle","tag":"label","css":"auth-info-title amc-flex-1 amc-ellipsis-2-line"}],"css":"auth-info-title-box"},{},{"id":"authItemsBox","tag":"div","children":[{"tag":"div","css":"amc-1px-line"},{"id":"authItems","tag":"div","css":"amc-v-box auth-items"}],"css":"amc-v-box auth-items-box amc-hidden"},{"tag":"div","css":"amc-1px-line"}],"css":"amc-v-box amc-bg-white"},{"tag":"div","children":[{},{"id":"checkArea","tag":"div","css":"pd-lr amc-v-box"},{},{"id":"protocolArea","tag":"div","children":[{"id":"agree","tag":"label","children":[{"text":"{{agree}}","tag":"text"}],"css":"agree-label  amc-ellipsis-2-line font-m margin-r-xs"},{"id":"protocol","tag":"label","children":[{"text":"{{serve_protocol}}","tag":"text"}],"onclick":"showProtocol()","css":"font-m amc-theme-color amc-flex-1 amc-ellipsis-2-line"}],"css":"pd-lr protocol-area"},{"id":"container","tag":"div","children":[{"id":"confirmBtn","tag":"div","children":[{"id":"gifImg","tag":"embed","type":"MQPPayGifView","css":"btn-img amc-hidden"},{"id":"btnText","tag":"label","children":[{"text":"{{confirm_auth}}","tag":"text"}],"css":"amc-btn-text-color amc-font-super-l amc-btn-ellpsis"}],"onclick":"onSubmit()","css":"btn-primary amc-justify-center amc-align-center"}],"css":"pd-lr btn-box"}],"css":"amc-v-box"},{},{"id":"insideTipBox","tag":"div","children":[{"id":"insideTip","tag":"label","css":"inside-tip amc-text-center amc-ellipsis-2-line"}],"css":"amc-v-box amc-flex-1 inside-tip-box amc-hidden"}],"css":"amc-v-box amc-scroll-flex"}],"onkeydown":"onKeyDown()","css":"amc-body"}]},"format":"JSON","tplVersion":"5.1.3"}